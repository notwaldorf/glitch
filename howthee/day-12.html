<!DOCTYPE html>
<html lang="en">
  <head>
    <title>inktober experiment</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="style.css">
    <script src="sheriff.js"></script>
    <style>
      #wrapper { position: relative; }
      #output {
        position: absolute;
        background: transparent;
        top: 24px;
        left: 24px;
        box-shadow: none;
      }
      .fake-output span {
        opacity: 0;
      }
    </style>
  </head>
  <body>
    <h1>#inktober: an experiment</h1>
    <div id="wrapper" class="an-art" title="I'm starting with the 'I'm the sheriff of circle-punch', and adding a feature every day. To see the previous days, look at the Glitch code or go to howthee.glitch.me/day-x.html.">
      <pre class="fake-output" id="fake"></pre>
      <pre id="output"></pre>
    </div>
    <div class="an-art-label">
      <button class="action" onclick="window.location = `./day-${today-1}.html`">ðŸ”™</button>
      <div>
        <b>Day 12</b>: Can't Touch This. (Works better on non-mobile)
      </div>
      <button class="action" onclick="window.location = `./day-${today+1}.html`">ðŸ”œ</button>
    </div>

    <footer>
      <hr>
      <h3>a weird art experiment by <a href="https://twitter.com/notwaldorf">monica</a></h3>
    </footer>
    <div class="glitchButton" style="position:fixed;top:20px;right:20px;"></div>
    <script src="https://button.glitch.me/button.js"></script>
  </body>
  <script>
    const today = 12;
    output.innerHTML = getSheriff('ðŸ”€');
    fake.innerHTML = getSheriff('ðŸ”€');
    
    let directionX;
    let directiony;
    let oldX = 0, oldY = 0;
    
    document.body.addEventListener('mouseover', doTheThing);
    document.body.addEventListener('click', doTheThing);
    
    function doTheThing(event) {
      const dx = event.pageX - oldX;
      const dy = event.pageY - oldY;
      directionX = dx > 0 ? 1 : -1;
      directionY = dy > 0 ? 1 : -1;
     
      oldX = event.pageX;
      oldY = event.pageY;
      
      // Ignore non-emoji bits.
      let target = event.target;
      if (target.localName === 'span') target = target.parentElement;
      if (!target.classList.contains('pixel'))
        return;
      if  (target.classList.contains('space'))
        return;
      
      const AMOUNT = 20;
      const BASE = 20;
      
      if (dx !== 0) {
        const left = parseInt(output.style.left) || 0;
        output.style.left = left + directionX * (Math.floor(Math.random() * AMOUNT) + BASE) + 'px';
      }
      if (dy !== 0) {
        const top = parseInt(output.style.top) || 0;
        output.style.top = top + directionY * (Math.floor(Math.random() * AMOUNT) + BASE) + 'px';
      }
    }
  </script>
</html>
